<!DOCTYPE html>
<html>
    <head>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

        <style>

          body {
            background-color: #f7ecda;
          }

        </style>
        <script>
          document.addEventListener('DOMContentLoaded', function() {

            let searchQuery;
            let selectedGenre;

            const dropdownItems = document.querySelectorAll('.dropdown-item');

            dropdownItems.forEach(item => {
              item.addEventListener('click', function () {
                const selectedGenre = item.value;
                // Update the button text with the selected genre
                document.getElementById('genreDropdownButton').textContent = selectedGenre;
                // Store the selected genre in a data attribute for easy access
                document.getElementById('genreDropdown').setAttribute('data-selected-genre', selectedGenre);
              });
            });

            const queryParams = new URLSearchParams(window.location.search);

            // Set the selected genre from query parameters
            const genreParam = queryParams.get('genre');
            if (genreParam) {
                document.getElementById('genreDropdownButton').textContent = genreParam;
                document.getElementById('genreDropdown').setAttribute('data-selected-genre', genreParam);
            }

            // Set the search query from query parameters
            const searchParam = queryParams.get('search');
            if (searchParam) {
                document.getElementById('searchInput').value = searchParam;
            }
            

            for (const p of queryParams) {
              console.log(p);
            }

            console.log(queryParams.page);

            // Fetch data from the server
            fetch("/getSoftwareList?" + queryParams.toString())
              .then(response => response.json())
              .then(responseData => {
                // Manipulate the DOM with the fetched data
                const tableBody = document.querySelector('.table tbody');

                const data = responseData.softwareList; // Extract the softwareList property

                data.forEach((item, index) => {
                  const row = document.createElement('tr');
                  row.className = 'roww';
        
                  const cells = [
                    document.createElement('th'),
                    document.createElement('td'),
                    document.createElement('td'),
                    document.createElement('td'),
                    document.createElement('td'),
                    document.createElement('td'),
                    document.createElement('td')
                  ];
        
                  cells[0].textContent = index + 1;
                  cells[1].textContent = item.name;
                  cells[2].textContent = item.genre;
                  cells[3].textContent = item.description;
                  cells[4].textContent = `$${item.price}`;
                  cells[5].textContent = item.numDownloads;
                  cells[6].innerHTML = `<a href="#" class="btn btn-outline-secondary">Check out</a>`;
        
                  cells.forEach(cell => row.appendChild(cell));
                  tableBody.appendChild(row);
                });

                generatePagination(responseData.totalPages);
              })
              .catch(error => console.error('Error fetching data:', error));

              fetch('/getTopSoftware')
              .then(response => response.json())
              .then(data => {
                // Manipulate the DOM with the fetched data
                const carouselInner = document.querySelector('.carousel-inner');

                data.forEach((item, index) => {
                  const carouselItem = document.createElement('div');
                  carouselItem.className = index === 0 ? 'carousel-item active' : 'carousel-item';

                  const img = document.createElement('img');
                  img.src = item.imageLink; // Assuming your software object has an "imageLink" property

                  const caption = document.createElement('div');
                  caption.className = 'carousel-caption';
                  caption.innerHTML = `<h5>${item.name}</h5><p>${item.description}</p>`;

                  carouselItem.appendChild(img);
                  carouselItem.appendChild(caption);

                  carouselInner.appendChild(carouselItem);
                });
              })
              .catch(error => console.error('Error fetching data:', error));
          });

          function handleFormSubmit(event) {
            console.log("triessss");
            event.preventDefault();

            // Get values from the form
            searchQuery = document.getElementById('searchInput').value;
            // Retrieve the selected genre from the data attribute
            selectedGenre = document.getElementById('genreDropdown').getAttribute('data-selected-genre');

            // Construct the new URL with search and filter parameters
            const newURL = `/browse?page=1&search=${searchQuery}&genre=${selectedGenre}`;

            // Redirect to the new URL
            window.location.href = newURL;
          }

          function generatePagination(totalPages) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            console.log(totalPages);

            for (let i = 1; i <= totalPages; i++) {
              const li = document.createElement('li');
              li.className = 'page-item';
              li.innerHTML = `<a class="page-link" href="#" onclick="loadSoftwarePage(${i})">${i}</a>`;
              pagination.appendChild(li);
            }
          }

          function loadSoftwarePage(pageNumber) {

            searchQuery = document.getElementById('searchInput').value;
            // Retrieve the selected genre from the data attribute
            selectedGenre = document.getElementById('genreDropdown').getAttribute('data-selected-genre');
            // Construct the new URL with the updated page parameter
            var newURL;
            newURL = `/browse?page=${pageNumber}&search=${searchQuery}&genre=${selectedGenre}`;


              // Redirect to the new URL
            window.location.href = newURL;
          }
        </script>
    </head>
<body>

  <!-- Navbar -->
    <nav class="navbar navbar-expand-lg" style="background-color: #e6c670; margin-bottom: 50px;">
      <div class="container-fluid">
        <a class="navbar-brand" href="home.html">Home</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="browse.html">Browse</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="Provider.html">Licenses</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="MainClient.html">Account</a>
            </li>
          </ul>
          <ul class="d-flex navbar-nav mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="login.html">Log In</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!--End of navbar-->

    <div class="ms-5 me-5">
      <br/>
      <br/>

      <p class="h3" style="margin-bottom: 50px;">Our deals</p>

      <div id="carouselBestdeals" class="carousel slide carousel-fade mx-auto mb-5 carousel-dark" style="width: 900px;">
        <div class="carousel-inner">
          <!--div class="carousel-item active">
            <div class="row row-cols-1 row-cols-md-3 g-4" style="text-align: center;">
              <div class="col">
                <div class="card">
                  <img src="https://i.pinimg.com/564x/84/84/47/84844787f6e370e8cb14154d3ba7f7aa.jpg" class="card-img-top" alt="Paint" style="width:200px;height:200px; display: block; margin-left: auto; margin-right: auto;">
                  <div class="card-body">
                    <h5 class="card-title">Paint Platinum</h5>
                    <p class="card-text">Paint in platinum with the improved version of Paint...</p>
                    <p class="card-text">34.99$</p>
                    <a href="#" class="btn btn-outline-secondary stretched-link">Check out</a>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="card">
                  <img src="https://images-na.ssl-images-amazon.com/images/I/416rhOVJs4L.jpg?quality=50&strip=all" class="card-img-top" alt="Photoshop" style="width:200px;height:200px; display: block; margin-left: auto; margin-right: auto;">
                  <div class="card-body">
                    <h5 class="card-title">Adobe Photoshop</h5>
                    <p class="card-text">Graphical editor used to modify your photos and...</p>
                    <p class="card-text">69.99$</p>
                    <a href="#" class="btn btn-outline-secondary stretched-link">Check out</a>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="card">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Calligrakrita-base.svg/1200px-Calligrakrita-base.svg.png" class="card-img-top" alt="Krita" style="width:200px;height:200px; display: block; margin-left: auto; margin-right: auto;">
                  <div class="card-body">
                    <h5 class="card-title">Krita+</h5>
                    <p class="card-text">The Krita software you love with additional filtering options...</p>
                    <p class="card-text">4.99$</p>
                    <a href="#" class="btn btn-outline-secondary stretched-link">Check out</a>
                  </div>
                </div>
              </div>
            </div>
          </div-->
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselBestdeals" data-bs-slide="prev" style="margin-left: -100px;">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselBestdeals" data-bs-slide="next" style="margin-right: -100px;">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>

      <p class="h3" style="margin-bottom: 50px;">Explore</p>

      <form class="d-flex" role="search" onsubmit="handleFormSubmit(event)">
        <!-- Add an ID to the input field for easy access in JavaScript -->
        <div class="dropdown me-2">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="genreDropdownButton" data-bs-toggle="dropdown" aria-expanded="false">Filter</button>
          <ul class="dropdown-menu" id="genreDropdown">
            <li><button class="dropdown-item" type="button" value="Graphical">Graphical</button></li>
            <li><button class="dropdown-item" type="button" value="Coding">Coding</button></li>
            <li><button class="dropdown-item" type="button" value="Lifestyle">Lifestyle</button></li>
          </ul>
        </div>
        <!-- Add an ID to the input field for easy access in JavaScript -->
        <input id="searchInput" class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>
        
      <br/>

      <div>
        <table class="table table-warning table-striped-columns table-borderless table-hover">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Software</th>
              <th scope="col">Genre</th>
              <th scope="col">Description</th>
              <th scope="col">Price</th>
              <th scope="col">Number of downloads</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody class="table-group-divider">
            
          </tbody>
        </table>
      </div>

      <nav aria-label="Page navigation example">
        <ul class="pagination" id="pagination">
          <!-- Previous button -->
          <li class="page-item" id="prevPage">
            <a class="page-link" href="#" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
      
          <!-- Page numbers will be dynamically added here -->
      
          <!-- Next button -->
          <li class="page-item" id="nextPage">
            <a class="page-link" href="#" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>

  </div>

  <footer class="flex-shrink-0 py-4 bg-dark text-white-50" style="margin-top: 100px;">
    <div class="container text-center">
      <small>Copyright &copy; Your Licenses</small>
    </div>
  </footer>
</body>
</html>